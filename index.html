<!DOCTYPE html>
<script src='https://d3js.org/d3.v5.min.js'></script>

<style> circle {fill: lightblue; stroke: black;} 
line {fill: none; stroke: steelblue; stroke-width: 2px;}
</style>

<button onclick="full()"> See all Episodes
</button>

<button onclick="step1()"> See Timeline
</button>

<body onload='init()'>
<svg width=1500 height=700>
</svg>
<script>
   
   
  function init() {
     
    const x = d3.scaleLinear().domain([1, 683]).range([0, 1400]);
    const xaxis = d3.axisBottom(x).tickValues([100, 200, 300, 400, 500, 600]).tickFormat(d3.format("~s"));
     
    const x2 = d3.scaleLinear().domain([0.75, 31]).range([0, 1400]);
    const xaxis2 = d3.axisBottom(x2).tickValues([5, 10, 15, 20, 25, 30]).tickFormat(d3.format("~s"));
  
    const y = d3.scaleLinear().domain([4, 10]).range([600, 0]);
    const yaxis = d3.axisLeft(y).tickValues([4, 6, 8, 10]).tickFormat(d3.format("~s"));
     
    d3.select('svg').append('g').attr("transform", "translate(" + 50 + "," + 50 + ")");
    d3.select("svg").append("g").attr("transform", "translate(" + 50 + "," + 50 + ")").call(yaxis);
    d3.select("svg").append("g").attr("transform", "translate(" + 50 + "," + 650 + ")").call(xaxis);
    d3.select("svg").append("g").attr("transform", "translate(" + 50 + "," + 600 + ")").call(xaxis2);
     
  };
   
  async function step1() {
     
   const seas = await d3.csv("https://raw.githubusercontent.com/AlexZurski/NarrativeViz/main/SimpsonAverage.csv");
     
   const x2 = d3.scaleLinear().domain([0.75, 31]).range([0, 1400]);
   const y = d3.scaleLinear().domain([4, 10]).range([600, 0]);
   
   const line = d3.line()
    .x(d => x2(seas(d.Season)))
    .y(d => y(seas(d.Rating)))

const path = d3.select('svg')
  .append("path")
  .attr("transform", `translate(50,0)`)
  .data(seas)
  .attr("fill", "none")
  .attr("stroke", "steelblue")
  .attr("stroke-linejoin", "round")
  .attr("stroke-linecap", "round")
  .attr("stroke-width", 1.5)
  .attr("d", line);

const pathLength = path.node().getTotalLength();

const transitionPath = d3
  .transition()
  .ease(d3.easeSin)
  .duration(2500);

path
  .attr("stroke-dashoffset", pathLength)
  .attr("stroke-dasharray", pathLength)
  .transition(transitionPath)
  .attr("stroke-dashoffset", 0);
     
  }
   
  async function full() {
    const epis = await d3.csv("https://raw.githubusercontent.com/AlexZurski/NarrativeViz/main/SimpsonData.csv");
     
    const x = d3.scaleLinear().domain([1, 683]).range([0, 1400]);
    const y = d3.scaleLinear().domain([4, 10]).range([600, 0]);
     
    d3.select('svg').append("g").attr("transform", "translate(" + 50 + "," + 50 + ")")
       .selectAll('circle').data(epis).enter().append('circle')
       .attr("cx", function(d) { return x(d["Episode"]); })
       .attr("cy", function(d) { return y(d["Rating"]); })
       .attr("r", function(d) { return 2; });
  }
   
 </script>
 </body>
